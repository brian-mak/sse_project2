<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Saved Lists Manager</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .list-form, .list-display {
            margin-bottom: 20px;
        }
        .list {
            background-color: #f0f0f0;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h2>Create a New Saved List</h2>
    <div class="list-form">
        <input type="text" id="newListName" placeholder="Enter list name">
        <button onclick="createSavedList()">Create List</button>
    </div>

    <h2>Your Saved Lists</h2>
    <div id="savedListsContainer">
        <!-- Saved lists will be displayed here -->
    </div>

    <script>
        function createSavedList() {
            const listName = document.getElementById('newListName').value;
            const userId = '{{ user_id }}';
            if (listName && userId) { // Ensure both listName and userId are provided
                fetch('/db/saved_lists/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ list_name: listName, user_id: userId }) // Adjusted to match expected keys
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('List created successfully!');
                        fetchSavedLists(); // Refresh the list of saved lists
                    } else {
                        alert('Failed to create list: ' + data.message);
                    }
                })
                .catch(error => console.error('Error:', error));
            } else {
                alert('Please enter a list name and ensure user ID is available.');
            }
        }

        function fetchExercisesForList(listId) {
            fetch(`/db/api/saved_lists/${listId}/exercises`)
            .then(response => response.json())
            .then(data => {
                const exercises = data.flat(); // Flatten the nested array structure
                const container = document.getElementById('savedListsContainer');
                container.innerHTML = ''; // Clear the container for exercises
                console.log(exercises); // Debugging to view the structure
                exercises.forEach(exercise => {
                    // Display each exercise in the format used in exercises.html
                    const exerciseDiv = document.createElement('div');
                    exerciseDiv.className = 'exercise';
                    exerciseDiv.innerHTML = `
                        <h3>${exercise.name}</h3>
                        <p><strong>Equipment Required:</strong> ${exercise.equipment}</p>
                        <p><strong>Target Muscle Group:</strong> ${exercise.target}</p>
                        <p><strong>Secondary Muscles:</strong> ${exercise.secondaryMuscles.join(', ')}</p>
                        <p><strong>Instructions:</strong></p>
                        <ol class="instructions">
                            ${exercise.instructions.map(instruction => `<li>${instruction}</li>`).join('')}
                        </ol>
                        ${exercise.gifUrl ? `<img src="${exercise.gifUrl}" alt="${exercise.name} GIF" style="max-width: 100%; height: auto;">` : ''}
                        <button onclick="removeExerciseFromSavedList('${listId}', '${exercise.id}')">Remove from Saved List</button>
                    `;
                    container.appendChild(exerciseDiv);
                });
            })
            .catch(error => console.error('Error:', error));
        }

        // function fetchExercisesForList(listId) {
            
        //     fetch(`/db/api/saved_lists/${listId}/exercises`)
        //     .then(response => response.json())
        //     .then(exercises => {
        //         // exercises = [[{'bodyPart': 'chest', 'equipment': 'kettlebell', 'gifUrl': 'https://v2.exercisedb.io/image/yTgNBK3XIYfbtg', 'id': '0519', 'name': 'kettlebell alternating press on floor', 'target': 'pectorals', 'secondaryMuscles': ['shoulders', 'triceps'], 'instructions': ['Start by lying on your back on the floor with your knees bent and feet flat on the ground.', 'Hold a kettlebell in each hand, with your palms facing towards your feet and your arms extended straight up towards the ceiling.', 'Lower one kettlebell down towards your shoulder while keeping the other kettlebell extended straight up.', 'Press the lowered kettlebell back up to the starting position while simultaneously lowering the other kettlebell down towards your shoulder.', 'Continue alternating the press motion with each kettlebell for the desired number of repetitions.']}], [{'bodyPart': 'chest', 'equipment': 'kettlebell', 'gifUrl': 'https://v2.exercisedb.io/image/WQ1usU-fCWqN5i', 'id': '0531', 'name': 'kettlebell extended range one arm press on floor', 'target': 'pectorals', 'secondaryMuscles': ['triceps', 'shoulders'], 'instructions': ['Start by lying on your back on the floor with your knees bent and feet flat on the ground.', 'Hold a kettlebell in one hand, with your palm facing towards your feet.', 'Extend your arm straight up towards the ceiling, keeping your elbow locked and your wrist straight.', 'Slowly lower the kettlebell back down to the starting position, maintaining control throughout the movement.', 'Repeat for the desired number of repetitions, then switch to the other arm.']}]];
        //         const container = document.getElementById('savedListsContainer');
        //         container.innerHTML = ''; // Clear the container or create a new container for exercises
        //         console.log(exercises);
        //         exercises.forEach(exercise => {
        //             // Display each exercise in the format used in exercises.html
        //             const exerciseDiv = document.createElement('div');
        //             exerciseDiv.className = 'exercise';
        //             exerciseDiv.innerHTML = `
        //                 <h3>${exercise.name}</h3>
        //                 <p><strong>Equipment Required:</strong> ${exercise.equipment}</p>
        //                 <p><strong>Target Muscle Group:</strong> ${exercise.target}</p>
        //                 // `;
        //             //     <p><strong>Secondary Muscles:</strong> ${exercise.secondaryMuscles.join(', ')}</p>
        //             //     <p><strong>Instructions:</strong></p>
        //             //     <ol class="instructions">
        //             //         ${exercise.instructions.map(instruction => `<li>${instruction}</li>`).join('')}
        //             //     </ol>
        //             //     ${exercise.gifUrl ? `<img src="${exercise.gifUrl}" alt="${exercise.name} GIF" style="max-width: 100%; height: auto;">` : ''}
        //             //     <button onclick="removeExerciseFromSavedList('${listId}', '${exercise.WorkoutID}')">Remove from Saved List</button>
        //             // `;
        //             container.appendChild(exerciseDiv);
        //         });
        //     })
        //     .catch(error => console.error('Error:', error));
        // }

        function makeListClickable() {
            const lists = document.querySelectorAll('.list');
            lists.forEach(list => {
                list.onclick = () => {
                    const listId = list.getAttribute('data-list-id');
                    fetchExercisesForList(listId);
                };
            });
        }

        function fetchSavedLists() {
            const userId = '{{ user_id }}';
            // Update the fetch URL to include the user_id as a query parameter
            fetch(`/db/api/user/saved_lists?user_id=${userId}`)
                .then(response => response.json())
                .then(lists => {
                    const container = document.getElementById('savedListsContainer');
                    container.innerHTML = ''; // Clear existing lists
                    lists.forEach(list => {
                        const div = document.createElement('div');
                        div.className = 'list';
                        div.setAttribute('data-list-id', list.list_id); // Make sure to set this attribute for clicking to work
                        div.textContent = list.name; // Assuming each list has a 'name' property
                        container.appendChild(div);
                    });
                    makeListClickable(); // Call makeListClickable here, after the lists have been added
                })
                .catch(error => console.error('Error fetching saved lists:', error));
        }

        // Load saved lists when the page loads
        window.onload = function() {
            fetchSavedLists();
        };
    </script>
</body>
</html>